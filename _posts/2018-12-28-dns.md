---
layout: post
title: Surge DNS配置
tags: Surge DNS
categories: Surge
---

部分用户由于 DNS 配置不合理导致网络访问缓慢，该指南说明了一些在配置 Surge DNS 时的注意事项。

>DNS 服务器的作用：在 IP 网络上（日常所使用的网络基本都是 IP 网络，包含 IPv4 网络和 IPv6 网络），必须使用 IP 地址才能访问另一个主机，但是由于 IP 地址难以记忆，且 IP 地址通常和地理位置相关不容易进行修改，所以一般我们使用域名去访问另一个主机，在访问的过程中通过 DNS 服务器将域名解析成 IP 地址。

<!-- more -->

### 配置 Surge DNS 服务器的一些要点：

* `速度与稳定性`：DNS 服务器需要保证稳定性和速度，所以应尽量使用地理位置靠近的 DNS 服务器。

*  `edns-client-subnet 支持`：对于巨型网站（如 apple.com），一般在全世界都配置有 CDN 服务器，有 ECS 支持的 DNS 服务器可以根据访问源 IP 地址，返回最合适的服务器 IP 地址。（但这种设计会有隐私泄露的可能，所以 1.1.1.1 并不支持。）

* `无需考虑使用代理策略的主机`：如果请求使用了代理策略，那么并不会在本地执行 DNS 查询，所以不需要为该类网络考虑 DNS 问题。（且只有代理服务器在远端执行 DNS 查询，才能确保得到一个最适合该代理服务器的 CDN 节点服务器地址。）

####  综上，对于中国用户，推荐的 DNS 配置如下:

+ **如果经常使用的网络没有 DNS 劫持问题：配置为使用系统 DNS 配置并追加 223.5.5.5 和 114.114.114.114 作为冗余。**
+ **如果经常使用的网络存在 DNS 劫持问题：配置为仅使用 223.5.5.5 和 114.114.114.114。**

* **8.8.8.8 和 1.1.1.1 在国内连通性不稳定，速度慢，且对国内网站的 CDN 支持不佳，不推荐使用。**

------

### 关于规则匹配过程的进阶说明

> 除了在使用 DIRECT 策略时需要使用 DNS 查询外，在进行规则匹配时也可能触发 DNS 查询，Surge 会按照规则顺序从上至下依次测试规则，如果一个使用域名的请求遇到了一个 IP 类型规则（IP-CIDR/IP-CIDR6/GEOIP）且该规则不带有 no-resolve 选项，那么将触发 DNS 查询。

> 所以应将所有非 IP 类规则置于规则的顶部，将 IP 类规则置于尾部，避免并不需要进行本地 DNS 查询的请求产生额外的 DNS 查询。





[官方原文链接](https://nssurge.zendesk.com/hc/zh-cn/articles/360011927114-DNS-%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97)
