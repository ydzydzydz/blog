---
layout: post
title: Surgeé…ç½®è¯¦è§£
tags: ç§‘å­¦ä¸Šç½‘ Surge Proxy SS Rules
categories: Surge Rules
---



[é…ç½®ç¤ºä¾‹](https://zhuangzhuang.cf/zhuangzhuang.conf)   

**ä½¿ç”¨å‰é¡»åœ¨ iCloud äº‘ç›˜/Surge/resources/policy/ æ–‡ä»¶å¤¹å†…åˆ›å»º [auto.list](https://raw.githubusercontent.com/ydzydzydz/Rules/master/Surge/resources/policy/auto.list) å’Œ [all.list](https://raw.githubusercontent.com/ydzydzydz/Rules/master/Surge/resources/policy/auto.list)**

[åœ¨æœ¬åœ°æ–°å»ºlistæ–‡ä»¶](http://zhuangzhuang.cf/2018-11-26/list/)

<!-- more -->

---
ä¿æŠ¤é…ç½®, åœ¨Surgeä¸­ä¸å¯ä¿®æ”¹ï¼ˆ**æ…ç”¨ï¼šä¼šå¯¼è‡´é…ç½®æ— æ³•ç¼–è¾‘ã€åˆ†äº«**ï¼‰
```ini
#!REQUIRE-PROTECTED
```
æ‰˜ç®¡é…ç½®ï¼Œ24hæ›´æ–°ä¸€æ¬¡
```ini
#!MANAGED-CONFIG https://raw.githubusercontent.com/ydzydzydz/Rules/master/conf/zhuangzhuang/zhuangzhuang.conf interval=86400 strict=true
```

* TOC
{:toc}
---

# [General]

æ—¥å¿—ç­‰çº§: warning, notify, info, verbose (é»˜è®¤å€¼: notify)
```ini
loglevel = notify
```

è·³è¿‡æŸä¸ªåŸŸåæˆ–è€… IP æ®µ, è¿™äº›ç›®æ ‡ä¸»æœºå°†ä¸ä¼šç”± Surge Proxy å¤„ç†

(macOS ç‰ˆæœ¬ä¸­, å¦‚æœå¯ç”¨äº† Set as System Proxy,  è¿™äº›å€¼ä¼šè¢«å†™å…¥åˆ°ç³»ç»Ÿç½‘ç»œä»£ç†è®¾ç½®)
```ini
skip-proxy = 127.0.0.1, 192.168.0.0/16, 193.168.0.0/24, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, localhost, *.local
```
å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„ DNS æœåŠ¡å™¨
```ini
dns-server = 223.5.5.5, 119.29.29.29, 114.114.114.114, 8.8.8.8, system, https://9.9.9.9/dns-query, https://cloudflare-dns.com/dns-query
```
ä½¿ç”¨ DNS over HTTPS ï¼ˆdns-server ä»…ä¼šç”¨ä½œè¿›è¡Œç½‘ç»œçŠ¶æ€æ£€æŸ¥å’Œè§£æ doh åŸŸåï¼‰

```ini
doh-server = https://doh.zhuangzhuang.ga/dns-query
```

è®¾ç½® DOH è¯·æ±‚å¯ä»¥ä½¿ç”¨è§„åˆ™ç³»ç»Ÿèµ°ä»£ç†ç­–ç•¥ï¼Œä½†è¯¥ç­–ç•¥å¿…é¡»æ˜¯ä¸€ä¸ªç›´æ¥ä½¿ç”¨ IP çš„ä»£ç†ç­–ç•¥

```ini
doh-follow-outbound-mode = true
```

è®¾ç½® DOH é»˜è®¤æ ¼å¼è¯·æ±‚ (jsonã€wireformat)

```ini
doh-format = json
```

å…è®¸å¤–éƒ¨æ§åˆ¶å™¨è®¿é—® Surge, Surge Dashboard æˆ– Surge CLI è¿›è¡Œç®¡ç†æ§åˆ¶

```ini
external-controller-access = passw@127.0.0.1:6170
```
æ˜¯å¦å¯åŠ¨å®Œæ•´çš„ IPv6 æ”¯æŒ (é»˜è®¤å€¼: false)
```ini
ipv6 = false
```
TUNè§„åˆ™åŒ¹é…æ¨¡å¼ (é»˜è®¤å€¼: false)

```ini
enhanced-mode-by-rule = 1
```

æ‹’ç»é¡µé¢æ˜¾ç¤ºé”™è¯¯

```ini
show-error-page-for-reject = true
```

ä¸åŒ…æ‹¬ç®€å•ä¸»æœºå

```ini
exclude-simple-hostnames = true
```
Surge ä½œä¸º HTTP/SOCKS5 ä»£ç†æœåŠ¡å™¨å‘ Wi-Fi ç½‘ç»œä¸‹çš„å…¶ä»–è®¾å¤‡æä¾›æœåŠ¡å™¨
```ini
allow-wifi-access = true
```
* Surge Mac ä¾›å¤–ç½‘è®¿é—®çš„æœåŠ¡ç«¯å£  
HTTP ä»£ç†æœåŠ¡ç«¯å£ (é»˜è®¤å€¼: 6152)
```ini
http-listen = 0.0.0.0:8888
```
SOCKS5 ä»£ç†æœåŠ¡ç«¯å£ (é»˜è®¤å€¼: 6153)
```ini
socks5-listen = 0.0.0.0:8889
```
* Surge iOS ä¾›å¤–ç½‘è®¿é—®çš„æœåŠ¡ç«¯å£  
HTTP ä»£ç†æœåŠ¡ç«¯å£ (é»˜è®¤å€¼: 6152)
```ini
wifi-access-http-port = 8888
```
SOCKS5 ä»£ç†æœåŠ¡ç«¯å£ (é»˜è®¤å€¼: 6153)
```ini
wifi-access-socks5-port = 8889
```

å…¼å®¹æ¨¡å¼ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
* ç¦ç”¨
```ini
compatibility-mode = 0
```
* Proxy with Loopback Address
```ini
compatibility-mode = 1
```
* Proxy Only
```ini
compatibility-mode = 2
```
* TUN Only
```ini
compatibility-mode = 3
```

å¯ç”¨ Network.framework (é»˜è®¤å€¼: false)

```ini
network-framework = true
```

INTERNET æµ‹è¯• URL (ä½¿ç”¨ç½‘ç»œè¯Šæ–­åŠŸèƒ½æ—¶è®¿é—®çš„ URL)

```ini
internet-test-url = http://wwww.gstatick.com/generate_204
```

ä»£ç†æµ‹é€Ÿ URL (æµ‹è¯•ä»£ç†ç­–ç•¥æ—¶çš„ URL)

```ini
proxy-test-url = http://wwww.gstatick.com/generate_204
```

æµ‹é€Ÿè¶…æ—¶ (ç§’)

```ini
test-timeout = 5
```

å¼ºåˆ¶ TCP è¿æ¥ä¸º HTTP è¿æ¥

```ini
force-http-engine-hosts = api.joybj.com
```

è¿”å›çœŸå® IP

```ini
always-real-ip = *.apple.com
```

åŠ«æŒå…¶å®ƒ DNS æœåŠ¡å™¨

```ini
hijack-dns = 8.8.8.8:53
```

ç»•è¿‡ç‰¹å®š IP èŒƒå›´

```ini
tun-excluded-routes = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12
```

åŒ…å«ç‰¹å®š IP èŒƒå›´

```ini
tun-included-routes = 192.168.1.12/32
```

TLS å¼•æ“ (defaultã€secure-transportã€opensslã€network-framework)

OpenSSL æˆ–è€… Network.Frameworkï¼Œå¯å¼€å¯ TLS 1.3 æ”¯æŒ

OpenSSL æ›´ç¨³å®šï¼ŒNetwork.Framework å¯æä¾›æ›´å¤šåŠŸèƒ½

```ini
tls-provider = default
```

å¦‚æœ Wi-Fi ä¿¡å·å¼±æˆ–ç½‘ç»œå¼‚å¸¸ï¼Œä¼šåœ¨ 2 ç§’åå°è¯•ä½¿ç”¨æ•°æ®ç½‘ç»œå»ºç«‹è¿æ¥

```ini
wifi-assist = true
```



---

# [Replica]
``è¯¥æ®µå®šä¹‰æŠ“å–æµé‡çš„è¿‡æ»¤``

éšè—æ‰€æœ‰å‘å¾€ *.Apple.com å’Œ *.icloud.com çš„è¯·æ±‚ï¼ˆè¯¥é€‰é¡¹åªæ˜¯åœ¨æŠ“å–ç»“æœä¸­éšè—äº†è¯·æ±‚ï¼‰
```ini
hide-apple-request = true
```
éšè—Crashlyticsè¯·æ±‚
```ini
hide-crashlytics-request = true
```
éšè—UDPä¼šè¯ï¼ˆé»˜è®¤å€¼: falseï¼‰
```ini
hide-udp = false
```
ä½¿ç”¨å…³é”®è¯è¿‡æ»¤å™¨ï¼ˆé»˜è®¤å€¼: falseï¼‰
```ini
use-keyword-filter = false
```

+ ä»…è®°å½•ä¸åŒ…å«å…³é”®å­—çš„è¯·æ±‚
```ini
keyword-filter-type = blacklist
```

+ ä»…è®°å½•åŒ…å«å…³é”®å­—çš„è¯·æ±‚
```ini
keyword-filter-type = whitelist
```

å…³é”®å­— (ä¾‹ï¼šabc def)

```ini
keyword-filter = abc,def
```



---
# [Proxy]

``è¯¥æ®µå®šä¹‰å¯ç”¨çš„ä»£ç†ç­–ç•¥``

å†™æ³•æ˜¯ï¼šç­–ç•¥å = ä»£ç†ç±»å‹, ä»£ç†åœ°å€, ç«¯å£å·, ç”¨æˆ·å, å¯†ç 

ä¸åŒçš„ç±»å‹å¡«å†™çš„å…·ä½“é¡¹ç›®ä¼šæœ‰å·®å¼‚, å»ºè®®åœ¨ UI ç•Œé¢ä¸­å¡«å†™

ç­–ç•¥åä¸å¯é‡å¤, ç­–ç•¥åé¡»å…ˆå®šä¹‰æ‰èƒ½åœ¨å…¶å®ƒéƒ¨åˆ†å¼•ç”¨
```ini
ProxyHTTP = http, [SERVER ADDRESS], [GENERATED PORT], username = ç”¨æˆ·å, password = å¯†ç 
ProxyHTTPS = https, [SERVER ADDRESS], [GENERATED PORT], username = ç”¨æˆ·å, password = å¯†ç 
ProxySOCKS5 = socks5, [SERVER ADDRESS], [GENERATED PORT], username = ç”¨æˆ·å, password = å¯†ç 
ProxySOCKS5TLS = socks5-tls, [SERVER ADDRESS], [GENERATED PORT], username = ç”¨æˆ·å, password = å¯†ç , skip-common-name-verify=true
ProxySnell = snell, [SERVER ADDRESS], [GENERATED PORT], psk=[GENERATED PSK], obfs=http
ProxyShadowsocks01 = custom, [SERVER ADDRESS], [GENERATED PORT], chacha20-ietf-poly1305, password, https://raw.githubusercontent.com/ydzydzydz/Rules/master/SSEncrypt/SSEncrypt.module
ProxyShadowsocks02 = ss, [SERVER ADDRESS], [GENERATED PORT], encrypt-method = rc4-md5, password = å¯†ç 
ProxyVmess= vmess, [SERVER ADDRESS], [GENERATED PORT], username = [UUID], ws=true, tls=true, ws-path=/v2, ws-headers=X-Header-1:value|X-Header-2:value
ProxyTrojan = trojan, [SERVER ADDRESS], [GENERATED PORT], password = [PASSWORD]
```

å¯é€‰å‚æ•°ï¼š


* å¼€å¯ TCP Fast Open

  ```ini
  tfo = true
  ```

* å¼€å¯ UDP

  ```ini
  udp-relay = true
  ```

* å¼€å¯ MPTCP

  ```ini
  mptcp = true
  ```

åˆ©ç”¨æœåŠ¡å™¨å®šä¹‰çš„æ–¹å¼å®ç°çš„å¹¿å‘Šé€šè¿‡é€‰æ‹©

Ad-Pass ä¸æ‹¦æˆªå¹¿å‘Š, Ad-Block ç›´æ¥æ‹’ç», Ad-GIF è¿”å›ä¸€ä¸ªé€æ˜åƒç´ å›¾
```ini
Ad-Pass = direct
Ad-Block = reject
Ad-GIF = reject-tinygif
```
---
# [Proxy Group]
``è¯¥æ®µå®šä¹‰å¯ç”¨çš„ç­–ç•¥ç»„``

**æœ‰ 5 ç§ç­–ç•¥ç»„ç±»å‹:  selectã€url-testã€fallbackã€ssid å’Œ load-balance**

select: å…·ä½“å“ªä¸ªå­ç­–ç•¥å°†è¢«ä½¿ç”¨, ç”±ç”¨æˆ·ç•Œé¢ä¸Šè¿›è¡Œé€‰æ‹©

ssid: å…·ä½“å“ªä¸ªå­ç­–ç•¥å°†è¢«ä½¿ç”¨, æ ¹æ® Wi-FI çš„ SSID å†³å®š

url-test: å…·ä½“å“ªä¸ªå­ç­–ç•¥å°†è¢«ä½¿ç”¨, é€šè¿‡æµ‹è¯•åˆ°å…·ä½“ URL çš„è®¿é—®é€Ÿåº¦é€‰æ‹©

fallback: å…·ä½“å“ªä¸ªå­ç­–ç•¥å°†è¢«ä½¿ç”¨, é€šè¿‡æµ‹è¯•åˆ°å…·ä½“ URL çš„å¯ç”¨æ€§å†³å®š

load-balance: éšæœºé€‰ç”¨ä¸€ä¸ªå¯ç”¨çš„å­ç­–ç•¥

* æ‰‹åŠ¨é€‰æ‹©ï¼šAuto, Proxy01, Proxy02, Proxy03
```ini
Proxy = select, Auto, Proxy01 , Proxy02, Proxy03
```
* æ ¹æ® Wi-FI çš„ SSID å†³å®šï¼šé»˜è®¤ç­–ç•¥ Auto, æ•°æ®ç½‘ç»œç­–ç•¥ ProxyA, è¿æ¥åˆ° 123 çš„ Wi-FI ç½‘ç»œç­–ç•¥ ProxyB, è¿æ¥åˆ° 456 çš„ Wi-FI ç½‘ç»œç­–ç•¥ ProxyC
```ini
Scene = ssid, default = Auto, cellular = ProxyA, â€œ123â€ = ProxyB, â€œ456â€ = ProxyC
```
* å¯ç”¨æ€§è‡ªåŠ¨æµ‹è¯•ï¼šåŒ…å«ç­–ç•¥ Proxy01, Proxy02, Proxy03, æµ‹è¯• url ä¸º http://www.bing.com,  **é€‰å‡ºå¯ç”¨çš„ç¬¬ä¸€ä¸ªç­–ç•¥**,æµ‹è¯•å®Œæˆå‰ä½¿ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥
```ini
Video = fallback, Proxy01, Proxy02, Proxy03, url = http://www.bing.com/, evaluate-before-use = true
```

* å»¶è¿Ÿè‡ªåŠ¨æµ‹è¯•ï¼šåŒ…å«ç­–ç•¥ Proxy01,  Proxy02,  Proxy03, æµ‹è¯• url ä¸º http://www.bing.com, 600såä¸Šæ¬¡çš„æµ‹è¯•ç»“æœå°†è¢«æŠ›å¼ƒ, æ¯”åŸä¼˜é€‰çº¿è·¯çš„å“åº”æ—¶é—´, å¤§äº100msçš„æ—¶å€™, è§¦å‘çº¿è·¯å˜æ›´, å¦‚æœæŸç­–ç•¥åœ¨5såä¾ç„¶æ²¡æœ‰å®Œæˆ, æ”¾å¼ƒè¯¥ç­–ç•¥ã€‚   **é€‰å‡ºå»¶è¿Ÿæœ€ä½çš„ç­–ç•¥**ï¼Œæµ‹è¯•å®Œæˆå‰ä½¿ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥
```ini
Auto = url-test, Proxy01, Proxy02, Proxy03, url = http://www.bing.com/, interval = 600s, tolerance = 100ms, timeout = 5s, evaluate-before-use = true
```

* å‡è¡¡ç­–ç•¥ï¼šåŒ…å«ç­–ç•¥ Proxy01,  Proxy02,  Proxy03, æ¯ä¸ªè¿æ¥éšæœºä½¿ç”¨ä¸€ä¸ªå­ç­–ç•¥ï¼Œå½“ç»´æŒç­–ç•¥æ‰“å¼€æ—¶ï¼ŒåŒä¸€ä¸ªä¸»æœºåä¸€å®šä¼šä½¿ç”¨åŒä¸€ä¸ªå­ç­–ç•¥

```ini
Balance = load-balance, Proxy01, Proxy02, Proxy03, persistent=1
```

ä»¥ä»£ç†æœåŠ¡å™¨çš„é€‰æ‹©æ¨¡å¼å®ç°å¹¿å‘Šçš„é€šè¿‡é€‰æ‹©

```ini
AdBlock = select, Ad-GIF, Ad-Block, Ad-Pass
```
ç­–ç•¥ç»„çš„å¦ä¸€ç§å†™æ³•ï¼šå¼•ç”¨è¿œç¨‹æˆ–è€…æœ¬åœ°listæ–‡ä»¶, **æœ¬åœ°é¡»å°†listæ–‡ä»¶æ”¾ç½®åœ¨iCloudäº‘ç›˜Surgeæ–‡ä»¶å¤¹ä¸­**, [listæ–‡ä»¶ç¤ºä¾‹](https://raw.githubusercontent.com/ydzydzydz/Rules/master/proxy/all.list)

* è¿œç¨‹list
```ini
AdBlock = select, policy-path = https://raw.githubusercontent.com/ydzydzydz/Rules/master/Surge/resources/policy/ad.list
```
* æœ¬åœ°list
```ini
AdBlock = select, policy-path = ad.list
```

å¤–éƒ¨ç­–ç•¥ç»„é»˜è®¤æ›´æ–°é—´éš”æ—¶é—´ä¸º 24hï¼Œå¯è‡ªå®šä¹‰

```ini
ğŸš¦ Ad-Block = select, policy-path = https://raw.githubusercontent.com/ydzydzydz/Rules/master/Surge/resources/policy/ad.list, update-interval=300
```

[å…³äºç­–ç•¥ç»„çš„ç†è§£](https://github.com/Fndroid/jsbox_script/wiki/%E5%85%B3%E4%BA%8E%E7%AD%96%E7%95%A5%E7%BB%84%E7%9A%84%E7%90%86%E8%A7%A3)

---

# [Rule]
``è§„åˆ™å®šä¹‰éƒ¨åˆ†``

ä¸€æ¡è§„åˆ™æœ‰ä¸‰ä¸ªåŸºç¡€éƒ¨åˆ†:

|ç±»å‹|å€¼|ç­–ç•¥|æ³¨é‡Š(éå¿…éœ€)|
|----|----|----|----|
|DOMAIN,|www.apple.com,| DIRECT | //æ³¨é‡Š       |
|DOMAIN-SUFFIX,|apple.com,|DIRECT|//æ³¨é‡Š|
|DOMAIN-KEYWORD,|apple,|DIRECT|//æ³¨é‡Š|
|IP-CIDR,|10.0.0.0/8,|DIRECT|//æ³¨é‡Š|
|GEOIP,|CN,|DIRECT|//æ³¨é‡Š|
|USER-AGENT,|Instagram*,|ProxyA|//æ³¨é‡Š|
|URL-REGEX,|^http:\/\/google\\.com,|ProxyA|//æ³¨é‡Š|
|PROCESS-NAME,|Telegram,| ProxyA | //æ³¨é‡Š       |
|RULE-SET, |SYSTEM, |DIRECT|//æ³¨é‡Š|
|DOMAIN-SET, |hostname.txt, |DIRECT|//æ³¨é‡Š|
|AND, |((DOMAIN, abc.com), (USER-AGENT, Surge*)), |DIRECT|//æ³¨é‡Š|
|OR, |((DOMAIN, abc.com), (USER-AGENT, Surge*)), |DIRECT|//æ³¨é‡Š|
|NOT, |((DOMAIN, abc.com)), |ProxyA|//æ³¨é‡Š|
|DEST-PORT, |80, |DIRECT|//æ³¨é‡Š|
|SRC-IP, |192.168.20.100, |DIRECT|//æ³¨é‡Š|
|IN-PORT, |6152, |DIRECT|//æ³¨é‡Š|
|FINAL, | |ProxyA|//æ³¨é‡Š|

**æœ‰ä¸‰ç§åŸºäºåŸŸåçš„è§„åˆ™: â€œDOMAINâ€,  â€œDOMAIN-SUFFIXâ€ å’Œ â€œDOMAIN-KEYWORDâ€**
* å¦‚æœè¯·æ±‚åŸŸå®Œå…¨åŒ¹é…, åˆ™åŒ¹é…è§„åˆ™ã€‚
```ini
DOMAIN, www.apple.com, DIRECT
```
* å¦‚æœè¯·æ±‚çš„åŸŸä¸åç¼€åŒ¹é…, åˆ™åŒ¹é…è§„åˆ™ã€‚ä¾‹å¦‚:google.comåŒ¹é…www.google.com, mail.google.comå’Œgoogle.com, ä½†ä¸åŒ¹é…content-google.comã€‚
```ini
DOMAIN-SUFFIX, google.com, DIRECT
```
* å¦‚æœè¯·æ±‚çš„åŸŸåŒ…å«å…³é”®å­—, åˆ™åŒ¹é…è§„åˆ™ã€‚
```ini
DOMAIN-KEYWORD, apple, DIRECT
```
* å‚æ•°: force-remote-dns (é»˜è®¤å€¼: false)
å¦‚æœæŸè¯·æ±‚è¢«è¯¥è§„åˆ™åŒ¹é…,  ä¸”ç­–ç•¥ä¸æ˜¯DIRECT. é‚£ä¹ˆ DNS æŸ¥è¯¢å°†æ°¸è¿œåœ¨è¿œç«¯ä»£ç†æœåŠ¡å™¨æ‰§è¡Œ,  å³ä½¿è¯¥è¯·æ±‚ç”± Surge TUN å¤„ç†  

```ini
DOMAIN-KEYWORD, google, ProxyHTTP, force-remote-dns
```
**æœ‰ä¸¤ç§åŸºäºIPçš„è§„åˆ™: â€œIP-CIDRâ€ ,  â€œGEOIPâ€**

* å¦‚æœæ˜¯ä¸€ä¸ªä½¿ç”¨åŸŸåè¿›è¡Œè®¿é—®çš„è¯·æ±‚, é‚£ä¹ˆ Surge å°†è¿›è¡Œ DNS æŸ¥è¯¢ä»¥ç¡®è®¤æ˜¯å¦åº”è¯¥è¢«è¯¥è§„åˆ™åŒ¹é…. è‹¥ DNS æŸ¥è¯¢å¤±è´¥, å°†æ”¾å¼ƒè§„åˆ™åŒ¹é…è¿‡ç¨‹å¹¶ç›´æ¥ç»™å‡ºé”™è¯¯ã€‚
```ini
IP-CIDR, 10.0.0.0/8, DIRECT
```
* OPTIONS: no-resolve:(é»˜è®¤å€¼: false)
å¦‚æœæ˜¯ä¸€ä¸ªä½¿ç”¨åŸŸåè¿›è¡Œè®¿é—®çš„è¯·æ±‚, è·³è¿‡è¯¥æ¡è§„åˆ™, ä¸è§¦å‘ DNS æŸ¥è¯¢ã€‚
```ini
IP-CIDR, 192.168.0.0/16, DIRECT, no-resolve
```
* GeoIP CN, åŸºäº GeoIP æ•°æ®åº“åˆ¤æ–­åŸŸåå’Œ IP çš„å½’å±åœ°
```ini
GEOIP, CN, DIRECT
```

**æœ‰ä¸¤ç§HTTPè§„åˆ™: â€œUSER-AGENTâ€, â€œURL-REGEXâ€**

HTTPè§„åˆ™ç”¨äºHTTPè¯·æ±‚æˆ–HTTPSè¯·æ±‚ã€‚å®ƒä¸ä¼šå½±å“TCPè¿æ¥ã€‚

* USER-AGENT, å¦‚æœè¯·æ±‚çš„ç”¨æˆ·ä»£ç†åŒ¹é…, åˆ™åŒ¹é…è§„åˆ™ã€‚é€šé…ç¬¦*å’Œ?éƒ½å—æ”¯æŒã€‚
```ini
USER-AGENT, Instagram*, DIRECT
```
* URL-REGEX, å¦‚æœURLä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…, åˆ™åŒ¹é…è§„åˆ™ã€‚**æœ€æ–°ç‰ˆ Surge çš„ URL-REGEX è§„åˆ™æ”¯æŒ Mitm**
```ini
URL-REGEX, ^http://google\.com, DIRECT
```


* PROCESS-NAME, å¯ä»¥ä¸ºæŒ‡å®šçš„è¿›ç¨‹åˆ†é…ç­–ç•¥, è§„åˆ™ä»…é€‚ç”¨äºSurge Mac, Surge iOS ä¼šå¿½ç•¥äº†è¿™äº›è§„åˆ™ã€‚
```ini
PROCESS-NAME, Telegram, Proxy
```

**RULESETè§„åˆ™é›†**

è§„åˆ™é›†åŒ…å«å¤šæ¡å­è§„åˆ™, å¯ä»¥æ˜¯å¦ä¸€ä¸ªæœ¬åœ° list æ–‡ä»¶, æˆ–è€…æ˜¯ä¸€ä¸ª URLï¼ˆå½“å‰ç‰ˆæœ¬ä¸­å›ºå®šä¸ºæ¯ 24 å°æ—¶è¿›è¡Œä¸€æ¬¡è‡ªåŠ¨æ›´æ–°ï¼‰

* å†…ç½®äº†ä¸¤ä¸ªè§„åˆ™é›†ï¼š[SYSTEM](https://raw.githubusercontent.com/ydzydzydz/Rules/master/special/system.list)  å’Œ [LAN](https://raw.githubusercontent.com/ydzydzydz/Rules/master/special/lan.list)
```ini
RULE-SET, SYSTEM, DIRECT
RULE-SET, LAN, DIRECT
```
* list æ–‡ä»¶æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶, æ¯ä¸€è¡Œä¸ºä¸€ä¸ªè§„åˆ™, **æœ€åä¸å¯å†™ä¸Šç­–ç•¥å,** [listæ–‡ä»¶ç¤ºä¾‹](https://raw.githubusercontent.com/ydzydzydz/Rules/master/special/apple.list)   
```ini
RULE-SET, https://raw.githubusercontent.com/ydzydzydz/Rules/master/special/apple.list, Proxy
```

å¤–éƒ¨è§„åˆ™é›†é»˜è®¤æ›´æ–°é—´éš”æ—¶é—´ä¸º 24hï¼Œå¯è‡ªå®šä¹‰

```ini
RULE-SET,https://raw.githubusercontent.com/ydzydzydz/Rules/master/special/telegram.list,ğŸ›© Telegram,update-interval=300
```

**DOMAINSET è§„åˆ™**

æ”¯æŒç™¾ä¸‡çº§åˆ«çš„è§„åˆ™é›†ï¼Œåœ¨ hostname.txt æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªä¸»æœºåï¼ˆåŸŸåæˆ– IPï¼‰ï¼Œä»¥ . å¼€å¤´è¡¨ç¤ºåŒ¹é…æ‰€æœ‰å­åŸŸå

```ini
DOMAIN-SET, hostname.txt, DIRECT
```

**é€»è¾‘è§„åˆ™ä¸‰ç§ï¼šâ€œANDâ€,  â€œORâ€å’Œâ€œNOTâ€**

å¯ä»¥ç»„åˆå¤šä¸ªå­è§„åˆ™, ä¸”å¯è¿›è¡Œå¤šå±‚åµŒå¥—, ç”¨äºæŸäº›å¤æ‚åœºæ™¯çš„åˆ¤æ–­
* AND è¿ç®—ç¬¦è¡¨ç¤ºæ‰€æœ‰å­è§„åˆ™éƒ½åŒ¹é…æ—¶, ä½¿ç”¨è¯¥ç­–ç•¥ã€‚
```ini
AND, ((#Rule1), (#Rule2), (#Rule3)...), Policy
```
* OR è¿ç®—ç¬¦è¡¨ç¤ºä»»ä½•å­è§„åˆ™åŒ¹é…æ—¶, ä½¿ç”¨è¯¥ç­–ç•¥ã€‚
```ini
OR, ((#Rule1), (#Rule2), (#Rule3)...), Policy
```
* NOT è¿ç®—ç¬¦è¡¨ç¤ºå­è§„åˆ™æœªåŒ¹é…æ—¶, ä½¿ç”¨è¯¥ç­–ç•¥ã€‚
```ini
NOT, ((#Rule1)), Policy
```

**Miscellaneousè§„åˆ™ä¸‰ç§:â€œDEST-PORTâ€, â€œSRC-IPâ€å’Œâ€œIN-PORTâ€**
* DEST-PORT å¦‚æœè¯·æ±‚çš„ç›®æ ‡ç«¯å£åŒ¹é…, åˆ™è§„åˆ™åŒ¹é…ã€‚
```ini
DEST-PORT, 80, DIRECT
```
* SRC-IP å¦‚æœè¯·æ±‚çš„å®¢æˆ·ç«¯IPåœ°å€åŒ¹é…, åˆ™è§„åˆ™åŒ¹é…ã€‚ä»…é€‚ç”¨äºè¿œç¨‹æœºå™¨ã€‚
```ini
SRC-IP, 192.168.20.100, DIRECT
```
* IN-PORT å¦‚æœè¯·æ±‚çš„ä¼ å…¥ç«¯å£åŒ¹é…, åˆ™è§„åˆ™åŒ¹é…ã€‚Surgeåœ¨å¤šä¸ªç«¯å£ä¸Šç›‘å¬æ—¶å¾ˆæœ‰ç”¨ã€‚
```ini
IN-PORT, 6152, DIRECT
```


**Finalè§„åˆ™**  
FINALè§„åˆ™å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–è§„åˆ™ä¹‹åç¼–å†™ã€‚å®ƒå®šä¹‰äº†ä¸ä»»ä½•å…¶ä»–è§„åˆ™ä¸åŒ¹é…çš„è¯·æ±‚çš„é»˜è®¤ç­–ç•¥ã€‚

* DNS æŸ¥è¯¢å¤±è´¥èµ° Final è§„åˆ™
```ini
FINAL, Proxy, dns-failed
```

**è§¦å‘é€šçŸ¥**
* åŒ¹é…è§„åˆ™æ—¶å¼¹å‡º notification-text å®šä¹‰çš„å­—ç¬¦ä¸²
```ini
AND, ((DOMAIN, raw.githubusercontent.com), (USER-AGENT, Surge*)), DIRECT, notification-text=â€œè§„åˆ™é›†æ›´æ–°â€, notification-interval=3 //æ›´æ–°æé†’
```

---

# [Host]

``è¯¥æ®µå®šä¹‰æœ¬åœ° DNS è®°å½•``

è¯¥åŠŸèƒ½ç­‰åŒäº /etc/hosts, åŠ ä¸Šäº†æ³›è§£æå’Œåˆ«åæ”¯æŒã€‚
```ini
*.taobao.com = server:223.5.5.5
*.jd.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.example.com = server:https://cloudflare-dns.com/dns-query
cloudflare-dns.com = server:1.1.1.1
```

---

# [URL Rewrite]
``è¯¥æ®µå®šä¹‰é’ˆå¯¹ HTTP è¯·æ±‚çš„ URL é‡å®šå‘è§„åˆ™``

**Headeræ¨¡å¼**
* Surgeå°†ä¿®æ”¹Header, å¹¶åœ¨å¿…è¦æ—¶å°†è¯·æ±‚é‡å®šå‘åˆ°å¦ä¸€å°ä¸»æœºã€‚å®¢æˆ·ç«¯ä¸ä¼šæ³¨æ„åˆ°è¿™ä¸ªé‡å®šå‘æ“ä½œã€‚
```ini
^http://www\.google\.cn http://www.google.com header
```

**302æ¨¡å¼**
* Surgeåªä¼šè¿”å›302é‡å®šå‘å“åº”ã€‚å¦‚æœå¯ç”¨äº†ä¸»æœºåçš„MitM, åˆ™å¯ä»¥é‡å®šå‘HTTPSè¯·æ±‚ã€‚
```ini
^http://yachen\.com https://yach.me 302
```

**Rejectæ¨¡å¼**
* å¦‚æœæ¨¡å¼åŒ¹é…, åˆ™æ‹’ç»è¯·æ±‚ã€‚æ›¿æ¢å‚æ•°å°†è¢«å¿½ç•¥ã€‚å¦‚æœå¯ç”¨äº†ä¸»æœºåçš„MitM, å°†æ‹’ç»HTTPSè¯·æ±‚ã€‚
```ini
^http://ad\.com/ad\.png _ reject
```
---

# [Header Rewrite]

``é‡å®šå‘HTTPè¯·æ±‚æˆ–è€…ç¯¡æ”¹è¯·æ±‚Header``

**header-add**

* ä¸ºè¯·æ±‚å¤´æ·»åŠ ä¸€ä¸ªæ–°çš„header lineï¼Œå³ä½¿header lineå·²å­˜åœ¨
```ini
^http://example.com header-add DNT 1
```


   ```ini
   # ä¿®æ”¹å‰
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   
   # ä¿®æ”¹å:
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   DNT: 1     # è¯·æ±‚æŸä¸ªç½‘é¡µåº”ç”¨ç¨‹åºåœæ­¢è·Ÿè¸ªæŸä¸ªç”¨æˆ·
   ```



**header-del**

* ä»è¯·æ±‚å¤´ä¸­åˆ é™¤header line
```ini
^http://example.com header-del DNT
```
   ```ini
   # ä¿®æ”¹å‰:
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   DNT: 1

   # ä¿®æ”¹å:
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   ```

**header-replace**

* æ›¿æ¢è¯·æ±‚å¤´ï¼Œå¦‚æœè¯·æ±‚å¤´å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•ä¿®æ”¹
```ini
^http://example.com header-replace DNT 1
```
   ```ini
   # ä¿®æ”¹å‰:
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   DNT: 0

   # ä¿®æ”¹å:
   GET /index.html HTTP/1.1
   Host: example.com
   Connection: keep-alive
   User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML,  like Gecko) Version/10.1 Safari/603.1.30
   Accept-Language: en-us
   Accept-Encoding: gzip, deflate
   DNT: 1
   ```

å¦‚æœè¦åœ¨è¯·æ±‚å¤´å­—æ®µå­˜åœ¨æ—¶æ·»åŠ æˆ–æ›¿æ¢header lineï¼Œå¯ä»¥ä¸€èµ·ä½¿ç”¨header-addå’Œheader-delã€‚
```ini
^http://example.com header-del DNT
^http://example.com header-add DNT 1
```

---

# [SSID Setting]
* è¿æ¥åˆ° Apple Store çš„ Wi-Fi ç½‘ç»œæ—¶ Surge æš‚åœå·¥ä½œ  
éœ€è¦ Web éªŒè¯ç™»å½•çš„ Wi-Fi ç½‘ç»œä»¥åŠè·¯ç”±å™¨å·²ç»ç§‘å­¦ä¸Šç½‘çš„ Surge æŒ‚èµ·
```ini
â€œApple Storeâ€ suspend=true
```
* è®¡è´¹ç½‘ç»œæ¨¡å¼, å½“è¿æ¥åˆ°çƒ­ç‚¹åä¸º iPhone X çš„ç½‘ç»œæ—¶è‡ªåŠ¨åˆ‡æ¢ä¸ºè®¡è´¹æ¨¡å¼
```ini
â€œiPhone Xâ€ cellular-mode=true
```

---

# [MITM]

``Surgeå¯ä»¥é€šè¿‡MitMè§£å¯†HTTPSé€šä¿¡``

è·³è¿‡æœåŠ¡ç«¯è¯ä¹¦éªŒè¯
```ini
skip-server-cert-verify = true
```
ç”¨äºTCPè¿æ¥
```ini
tcp-Connection = true
```
~~è‡ªåŠ¨æ—è·¯~~ï¼ˆæœ€æ–°ç‰ˆå·²ç»åˆ æ‰äº†ï¼‰

```ini
auto-bypass = on
```

ä¸»æœºåï¼ˆé»˜è®¤åªè§£å¯†`443ç«¯å£`ï¼Œä½¿ç”¨`suffix:0`ä¸ºä¸»æœºåä¸Šçš„æ‰€æœ‰ç«¯å£å¯ç”¨Mitmï¼Œä½¿ç”¨`suffix:port`ä¸ºä¸»æœºåä¸Šçš„ç‰¹å®šç«¯å£å¯ç”¨Mitmï¼‰

```ini
hostname = api.chelaile.net.cnn.cn
```
æœ€æ–°ç‰ˆ Surge çš„ URL-REGEX è§„åˆ™æ”¯æŒ Mitmï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å‰ç¼€`-`æ’é™¤åŸŸå

```ini
hostname = -*.apple.com,-*.icloud.com,*
```

è¯ä¹¦ç”Ÿæˆå™¨å°†å¸®åŠ©æ‚¨ç”Ÿæˆç”¨äºè°ƒè¯•çš„æ–°CAè¯ä¹¦, å¹¶ä½¿è¯ä¹¦å—åˆ°ç³»ç»Ÿçš„ä¿¡ä»»ã€‚

å®ƒå¯ä»¥åœ¨ Surge Dashboard ( Mac ç‰ˆ )å’Œ Surge iOS é…ç½®ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ã€‚

è¿™ä¸ªè¯ä¹¦æ˜¯æœ¬åœ°ç”Ÿæˆçš„, åªä¼šä¿å­˜åœ¨é…ç½®æ–‡ä»¶å’Œç³»ç»Ÿå¯†é’¥é“¾ä¸­ã€‚

è¯ä¹¦å¯†é’¥æ˜¯ä½¿ç”¨OpenSSLéšæœºç”Ÿæˆçš„ã€‚

è¿˜å¯ä»¥ä½¿ç”¨[ç°æœ‰çš„CAè¯ä¹¦](https://zhuangzhuang.cf/2019-05-12/ca/)ã€‚å°†è¯ä¹¦å¯¼å‡ºåˆ°PKCS#12æ ¼å¼(.p12)ã€‚

è¯·æ³¨æ„, ç”±äºç³»ç»Ÿé™åˆ¶, å¯†ç ä¸èƒ½ä¸ºç©ºã€‚ä½¿ç”¨`base64å‘½ä»¤`å¯¹p12è¿›è¡Œç¼–ç , å¹¶å°†è¿™äº›è®¾ç½®é™„åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚
```ini
# P12å¯†ç 
ca-passphrase = zhuangzhuang

# base64ç¼–ç è¿‡çš„P12æ–‡ä»¶
ca-p12 = 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
```
**å®‰è£…è¯ä¹¦**
* é…ç½®æ ¹è¯ä¹¦-å®‰è£…è¯ä¹¦-è®¾ç½®-é€šç”¨æè¿°æ–‡ä»¶ä¸è®¾å¤‡ç®¡ç†-å®‰è£…
* **è®¾ç½®-é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®-ä¿¡ä»»**   

**å¼ºè¿«ç—‡æ‚£è€…[è§£å†³Surgeè¯ä¹¦æœªéªŒè¯](http://zhuangzhuang.cf/2018-11-26/qianming/)**

---

# [Snell Server]

`ä½¿ç”¨Surge Macä½œä¸ºSnellä»£ç†æœåŠ¡å™¨ï¼ˆä»3.1.0ç‰ˆæœ¬å¼€å§‹ï¼‰ã€‚`

```ini
interface = 0.0.0.0
port = 6160
psk = RANDOM_KEY_HERE
obfs = off
```

---

# [Script]

`ä½¿ç”¨ Surge æ‰§è¡Œ JavaScript è„šæœ¬`

æ¯ä¸€è¡Œä»¥ç©ºæ ¼åˆ†éš”ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºè„šæœ¬ç±»å‹ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºå€¼ï¼Œç¬¬ä¸‰éƒ¨åˆ†ä¸ºå‚æ•°è¡¨ï¼Œå‚æ•°ä»¥åŠè§’é€—å·éš”å¼€ã€‚

å‚æ•°è¡¨åŒ…å«çš„å‚æ•°æœ‰ï¼š

> + script-pathï¼šè„šæœ¬è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„æˆ–è€… URL
> + script-update-intervalï¼šå½“è„šæœ¬è·¯å¾„ä¸º URL æ—¶çš„è‡ªåŠ¨æ›´æ–°é¢‘ç‡ï¼Œå•ä½ä¸ºç§’
> + debugï¼šå¼€å¯ debug æ¨¡å¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæœ¬åœ°è„šæœ¬ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰§è¡Œè„šæœ¬æ—¶ï¼Œéƒ½ä¼šä»æœ¬åœ°å­˜å‚¨é‡æ–°åŠ è½½è„šæœ¬ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚ï¼ˆæœªæ¥ä¼šæœ‰æ›´å¤š debug åŠŸèƒ½åŠ å…¥ï¼‰
> + timeoutï¼šè„šæœ¬çš„æœ€é•¿è¿è¡Œæ—¶é—´ï¼Œé»˜è®¤ä¸º 10s
> + requires-bodyï¼šä»…å¯¹ http-request å’Œ http-response ç±»å‹ç”Ÿæ•ˆï¼Œè¡¨ç¤ºè¯¥è„šæœ¬éœ€è¦å¯¹ body è¿›è¡Œå¤„ç†ï¼Œé»˜è®¤ä¸º falseã€‚å¦‚æœåªéœ€è¦ä¿®æ”¹ URL æˆ–è€… Headers è¯·ä¸è¦å¼€å¯è¯¥é€‰é¡¹ï¼Œå°†å¤§å¹…èŠ‚çº¦èµ„æºã€‚
> + max-sizeï¼šä»…å¯¹ http-request å’Œ http-response ç±»å‹ç”Ÿæ•ˆï¼Œè¡¨ç¤ºè¯¥è„šæœ¬æœ€å¤§å…è®¸å¤„ç†çš„ body å¤§å°ï¼Œè‹¥è¶…è¿‡åˆ™æ”¾å¼ƒå¤„ç†ï¼Œé»˜è®¤å€¼ä¸º 131072 (128KB)ã€‚

ç”±äºè¿›è¡Œè„šæœ¬ä¿®æ”¹ä¼šéœ€è¦ Surge å…ˆå°† response body å®Œå…¨ä¸‹è½½åå†è¿›è¡Œå¤„ç†ï¼Œå¦‚æœé‡åˆ°äº†è¾ƒå¤§çš„æ•°æ®å°†å¯¼è‡´å†…å­˜å ç”¨é‡æš´å¢ï¼ŒSurge iOS å—ç³»ç»Ÿå†…å­˜é™åˆ¶åœ¨è¯¥æƒ…å†µä¸‹ææ˜“è¢«ç›´æ¥ç»ˆæ­¢ã€‚æ‰€ä»¥è¯·åŠ¡å¿…ä»”ç»†é…ç½® URL åŒ¹é…è§„åˆ™ï¼Œä»…å¯¹éœ€è¦çš„ URL è¿›è¡Œå¤„ç†ã€‚

å½“è¿”å›çš„æ•°æ®é•¿åº¦è¶…è¿‡ max-size è®¾å®šå€¼åï¼ŒSurge å°†æ”¾å¼ƒå¯¹è¯¥è¯·æ±‚æ‰§è¡Œè„šæœ¬å¹¶å›é€€åˆ° passthrough æ¨¡å¼ã€‚

æœ‰ä¸ƒç§è„šæœ¬ç±»å‹ï¼š

**http-request**

ç”¨äºä¿®æ”¹ HTTP è¯·æ±‚ä½“ï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºåŒ¹é… URL çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¢«åŒ¹é…åˆ°çš„è¯·æ±‚ä¼šè¢«æ‰§è¡Œè„šæœ¬ã€‚

```ini
http-request ^http://httpbin.org script-path=http-request.js,max-size=16384,debug=true,requires-body=true
```

**http-response**

ç”¨äºä¿®æ”¹ HTTP è¿”å›ä½“ï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºåŒ¹é… URL çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¢«åŒ¹é…åˆ°çš„è¯·æ±‚ä¼šè¢«æ‰§è¡Œè„šæœ¬ã€‚

```ini
http-response ^http://www.example.com/test script-path=test.js,max-size=16384,debug=true
```

**cron**

å¯é…ç½® Surge åœ¨ç‰¹å®šçš„æ—¶é—´æ‰§è¡Œè„šæœ¬ï¼Œè§¦å‘æ—¶é—´é…ç½®ä½¿ç”¨ crontab çš„æ ·å¼ã€‚è¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸º crontab è¡¨è¾¾å¼ï¼Œå¸¸è§çš„ crontab ä¸ºäº”ä½è¡¨ç¤ºï¼Œå³ * * * * * è¡¨ç¤ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ŒSurge å…¼å®¹äº”ä½è¡¨ç¤ºå’Œå…­ä½è¡¨ç¤ºï¼Œå¯ç”¨ * * * * * * è¡¨ç¤ºæ¯ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚ä½†ä¸æ”¯æŒ @daily è¿™æ ·çš„åˆ«åã€‚

```ini
cron "* * * * *" script-path=fired.js
```

**event**

åœ¨å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶æ‰§è¡Œè„šæœ¬ï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºäº‹ä»¶åç§°ï¼Œç›®å‰åªæœ‰ network-changed ä¸€ä¸ªäº‹ä»¶ã€‚

```ini
event network-changed script-path=network-changed.js
```

**rule**

ä½¿ç”¨è„šæœ¬è¿›è¡Œè§„åˆ™åˆ¤å®šï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºè§„åˆ™å

```ini
rule ssid-rule script-path=ssid-rule.js
```

**policy-group**

ä½¿ç”¨è„šæœ¬å»å†³å®š policy-groupï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºè„šæœ¬åã€‚

```ini
policy-group worst script-path=worst.js,debug=true
```

**dns**

ä½¿ç”¨è„šæœ¬å»æ‰§è¡Œ DNS è§£ææ“ä½œï¼Œè¯¥ç±»å‹ä¸‹ç¬¬äºŒå‚æ•°ä¸ºè„šæœ¬åã€‚

```ini
dns local script-path=dns.js,debug=true
```

å£®å£®åªåšäº†ç®€å•ä»‹ç»ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒ[å®˜æ–¹è®ºå›](https://community.nssurge.com/d/33-scripting)

---

# Module

`æ¨¡å—æ˜¯ä¸€ç³»åˆ—è®¾ç½®çš„é›†åˆï¼Œå¯ä»¥è¦†ç›–è¿½åŠ å½“å‰é…ç½®çš„éƒ¨åˆ†è®¾å®š`

**å†…ç½®æ¨¡å—**

Surge ä¼šé¢„ç½®ä¸€äº›æ¨¡å—ï¼Œéšç€ Surge æ›´æ–°è€Œæ›´æ–°

**æœ¬åœ°æ¨¡å—**

æ”¾ç½®é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆiCloud Drive/Surge/ï¼‰çš„ `*.sgmodule` æ–‡ä»¶ï¼Œæœ¬åœ°æ¨¡å—æœç´¢è·¯å¾„åŒ…å«å­ç›®å½•

**è¿œç¨‹æ¨¡å—**

ä»æŸä¸ª URL å®‰è£…æ¨¡å—ï¼Œè¿œç¨‹æ¨¡å—ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ–°

æ¨¡å—å¼€å¯çŠ¶æ€ä»…ä¿å­˜äºå½“å‰é…ç½®ï¼Œä¸ä¼šè¿›è¡ŒåŒæ­¥ï¼Œåˆ‡æ¢é…ç½®ä¹Ÿä¸å½±å“æ¨¡å—çš„å¼€å¯çŠ¶æ€

æ¨¡å—çš„å†…å®¹å’Œæ ‡å‡†é…ç½®åŸºæœ¬ä¸€è‡´ï¼Œç›®å‰æ”¯æŒè°ƒæ•´å­—æ®µçš„æœ‰ï¼š

[[General]](#general)ã€[[Replica]](#replica)

+ key = valueï¼šç›´æ¥è¦†ç›–åŸå§‹å€¼
+ key = %APPEND% valueï¼šåœ¨åŸå§‹å€¼çš„æœ«å°¾è¿›è¡Œè¿½åŠ ï¼ˆä»…é€‚ç”¨äºé€‚ç”¨é€—å·åˆ†éš”çš„å­—æ®µï¼‰
+ key = %INSERT% valueï¼šåœ¨åŸå§‹å€¼çš„å¼€å§‹è¿›è¡Œæ’å…¥ï¼ˆä»…é€‚ç”¨äºé€‚ç”¨é€—å·åˆ†éš”çš„å­—æ®µï¼‰

```ini
# æ¨¡å—å
#!name=Game Console SNAT
# æ¨¡å—ç®€ä»‹
#!desc=Let Surge handle SNAT conversation properly for PlayStation, Xbox, and Nintendo Switch. Only useful if Surge Mac acts the router for these devices.
# é™åˆ¶æ¨¡å—çš„ä½¿ç”¨èŒƒå›´ (iosã€mac)
#!system=mac

[General]
always-real-ip = %APPEND% *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com
```
[[MITM]](#mitm)

```ini
#!name=MitM All Hostnames
#!desc=Perform MitM on all hostnames with port 443, except those to Apple and other common sites which can't be inspected. You still need configure CA certificate and enable the main switch of MitM.

[MITM]
# æ¨¡å—å†…å®¹ï¼Œä¸æ ‡å‡†é…ç½®åŸºæœ¬ä¸€è‡´ï¼Œä»…æ”¯æŒæ“ä½œ hostname å­—æ®µ
# è·³è¿‡ Apple ç›¸å…³
hostname = %APPEND% -*.apple.com, -*.icloud.com, -*.mzstatic.com, -*.crashlytics.com, -*.facebook.com, -*.instagram.com
```

[[Script]](#script)ã€[[URL Rewrite]](#url-rewrite)ã€[[Header Rewrite]](#header-rewrite)ã€[[Host]](#host)

```ini
#!name=URL Rewrite
#!desc=After enabling the module, you may access the router configure webpage by accessing http://router.com in your bowser. The URL will always rediect to the gateway address in the current network.
#!system=ios

[URL Rewrite]
# æ¨¡å—å†…å®¹ï¼Œä¸æ ‡å‡†é…ç½®åŸºæœ¬ä¸€è‡´ï¼Œæ–°åŠ å…¥çš„å®šä¹‰å°†ä¼šæ’å…¥åœ¨åŸå§‹å†…å®¹çš„æœ€é¡¶éƒ¨ã€‚
# ç½‘å…³é‡å®šå‘
{% raw %}^http://router.com {{{GATEWAY_ADDRESS}}} 302{% endraw %}
{% raw %}^http://www.router.com {{{GATEWAY_ADDRESS}}} 302{% endraw %}
```

[[Rule]](#rule)

```ini
#!name=Rule Module
#!desc=Rule Module 

[Rule]
# æ–°é…ç½®çš„è§„åˆ™å°†è¢«æ’å…¥åœ¨æœ€é¡¶éƒ¨
# è§„åˆ™åªé€‚ç”¨äº DIRECTã€REJECTã€REJECT-TINYGIF ä¸‰ç§ç­–ç•¥
DOMAIN-SUFFIX, zhuangzhuang.cf, DIRECT
```

å…·ä½“å†…å®¹è¯·å‚è€ƒ[å®˜æ–¹è®ºå›](https://community.nssurge.com/d/225-module)

---
# å¤§ä½¬ä»¬çš„è§„åˆ™ï¼š

| é¡¹ç›®åœ°å€                                                     | æ·å¾„                                                         | JSBOX                                                        |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [Blankwonder/surge-list](https://github.com/Blankwonder/surge-list) |                                                              |                                                              |
| [Choler/Surge](https://github.com/Choler/Surge)              | [Surge](https://www.icloud.com/shortcuts/6da9a6c09618464d85c11580d81b1e51) |                                                              |
| [ConnersHua/Profiles](https://github.com/ConnersHua/Profiles) | [Surge2](https://www.icloud.com/shortcuts/0913876d77d647f7b229903edb3a9be0)/[Surge3](https://www.icloud.com/shortcuts/bbb973be542a4c4bba94101f2ae16bcf) |                                                              |
| [Hackl0us/SS-Rule-Snippet](https://github.com/Hackl0us/SS-Rule-Snippet) | [Surge2](https://www.icloud.com/shortcuts/eb5f7930bf8e414993452c3cae1906ca)/[Surge3](https://www.icloud.com/shortcuts/5dee27f365974ba7bec536adc543b24d) |                                                              |
| [lhie1/Rules](https://github.com/lhie1/Rules)                |                                                              | [Rules-lhie1](https://xteko.com/redir?name=Rules-lhie1&url=https://raw.githubusercontent.com/Fndroid/jsbox_script/master/Rules-lhie1/.output/Rules-lhie1.box) |
| [scomper/surge-list](https://github.com/scomper/surge-list)  |                                                              |                                                              |
| [tudi1909/Surge_iOS_Rules](https://github.com/tudi1909/Surge_iOS_Rules) |                                                              |                                                              |
| [tudi1909/Surge_macOS_Rules](https://github.com/tudi1909/Surge_macOS_Rules) |                                                              |                                                              |
| Neurogram                                                    |                                                              | [SurgeÂ³](https://xteko.com/redir?name=SurgeÂ³&url=https%3A%2F%2Fraw.githubusercontent.com%2FNeurogram-R%2FJSBox%2Fmaster%2FSurge%25c2%25b3.box&icon=icon_053.png&version=0.7.4&author=Neurogram) |
| [huanz/surge-hosts](https://github.com/huanz/surge-hosts)    |                                                              |                                                              |
| [XinSSS/Conf-for-Surge-Shadowrocket](https://github.com/XinSSS/Conf-for-Surge-Shadowrocket) |                                                              |                                                              |
| [h2y/Shadowrocket-ADBlock-Rules](https://github.com/h2y/Shadowrocket-ADBlock-Rules) |                                                              |                                                              |



# å¦‚ä½•è‡ªå·±å†™é…ç½®

æ¨èç¥æœºå¤§ä½¬çš„ï¼š[Surge ä½¿ç”¨æ‰‹å†Œ](https://chua.pro/more/subject-index/surge-manual/)

---

# å‚è€ƒï¼š

[scomper/Surge](https://github.com/scomper/Surge/blob/master/surge3.conf.ini)  
[Surge ç”¨æˆ·æ‰‹å†Œ](https://manual.nssurge.com/)

# åé¦ˆï¼š

[ZHUANGZHUANG](https://t.me/YDZ123456)

